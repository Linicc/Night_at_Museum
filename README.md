# 博物馆奇妙夜 (Night at Museum) - 人群行为模拟系统

## 项目背景
本项目旨在构建一个模拟人群在密闭环境中（如博物馆）遭遇突发状况（如火灾、地震、恐慌事件）时的行为模式预测系统。系统将人群中的每个个体模拟为具有独立属性的粒子，通过有时序性的元胞自动机（Cellular Automata）与社会力模型（Social Force Model）来预测群体行为，最终生成风险热力图，用于识别易发生踩踏或拥堵的高危区域。

## 核心功能

### 1. 粒子 (Agent) 模型
每个模拟个体包含以下特征：
*   **行动能力**: 基于年龄和状态的移动速度与加速度。
*   **反应速度**: 遇到危险时的反应延迟。
*   **心理素质**: 恐慌值的感染与抗性（Resilience）。
*   **家庭关系**: 粒子间可能存在家庭纽带，具有更强的聚集倾向。
*   **年龄属性**: 年龄直接影响移动能力、反应速度和心理素质。
*   **视野与感知**: (Planned) 粒子基于局部感知做出决策。

### 2. 场所与环境 (Environment)
支持构建复杂的室内环境：
*   **出入口**: 具有流量限制的入口和出口。
*   **障碍物**: 墙壁、柱子等不可通行区域。
*   **展览品**: 普通展品与特殊展品（特殊展品具有更强的吸引力，影响周围粒子流速）。
*   **安保疏导**: (Planned) 可引导周围粒子更高效地寻找出口。

### 3. 模拟与分析
*   **混合驱动引擎**: 结合元胞自动机与连续空间的社会力模型。
*   **数据采集**: 实时记录每帧所有粒子的位置、速度、恐慌等级。
*   **热力图生成**: 基于模拟历史数据，生成人群密度与滞留时间热力图。
*   **风险预测 (ML)**: (Planned) 使用机器学习（随机森林等）拟合环境特征与拥堵风险的关系。

## 项目结构

```text
Night_at_Museum/
├── config/                 # 配置管理
│   └── settings.py         # 全局参数（地图大小、时间步长、粒子数上限等）
├── core/                   # 模拟核心 (Simulation Engine)
│   ├── agent.py            # 粒子（个体）与家庭类定义
│   ├── environment.py      # 场所构造（网格、墙壁、出入口、展品）
│   ├── behaviors.py        # 行为逻辑（移动算法、恐慌传播、家庭牵引）
│   └── engine.py           # 模拟主循环控制器
├── analysis/               # 数据分析与ML (Analysis & ML)
│   ├── logger.py           # 实时数据采集
│   ├── heatmap.py          # 热力图生成器
│   └── risk_model.py       # 风险预测模型
├── visualization/          # 可视化 (Visualization)
│   └── viewer.py           # 实时展示模块
├── output/                 # 模拟结果输出目录（自动生成）
├── main.py                 # 程序入口
└── requirements.txt        # 依赖库
```

## 快速开始

### 1. 环境准备
确保已安装 Python 3.8+，并安装项目依赖：

```bash
pip install -r requirements.txt
```

### 2. 运行模拟
运行主程序启动模拟：

```bash
python main.py
```

程序运行结束后：
*   控制台将显示模拟进度。
*   结果数据将保存在 `output/simulation_log.csv`。
*   人群密度热力图将保存在 `output/heatmap.png`。

## 开发计划
*   [x] 基础项目结构搭建
*   [x] 核心 Agent 与 Environment 类实现
*   [x] 基础社会力行为模型 (移动、避障、家庭)
*   [x] 数据记录与热力图生成
*   [ ] 引入安保人员与动态路障
*   [ ] 完善机器学习风险预测模型
*   [ ] 开发 Web 可视化前端 (.Claude skills)

## 贡献
欢迎提交 Pull Request 或 Issue 来改进人群模拟算法。
